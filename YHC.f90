
    SUBROUTINE YHC4(t0,t1,X,Y)
    USE GlobalDef
    REAL(8) :: t0,t1,x(8),y(8)
    REAL(8) :: S,theta,phi,thetaA,S1,theta1,phi1,thetaA1,delta

    S = X(1)
    theta = X(2)
    phi = X(3)
    thetaA = X(4)
    S1 = X(5)
    theta1 = X(6)
    phi1 = X(7)
    thetaA1 = X(8)
    delta = theta-phi
    
    Y(1) = S1
    Y(2) = theta1
    Y(3) = phi1
    Y(4) = thetaA1
    Y(5) = S*(theta1+thetaA1)**2D0-(1D0/S**2D0 + 3D0/S**4D0*(A1+A2*DCOS(2D0*theta)+A3*DCOS(2D0*delta)))
    Y(6) = -2D0*S1/S*(theta1+thetaA1) - 2D0/S**5D0*(A2*DSIN(2D0*theta)+A3*DSIN(2D0*delta)) - 2D0*Mass*A2*DSIN(2D0*theta)/(IzA*S**3D0)
    Y(7) = 2D0*Mass*A3*DSIN(2D0*delta)/(IzB*S**3D0) - 2D0*Mass*A2*DSIN(2D0*theta)/(IzA*S**3D0) !- 5D-5
    Y(8) = 2D0*Mass*A2*DSIN(2D0*theta)/(IzA*S**3D0)
    end
    
    SUBROUTINE YHC4B(T0,T1,X,Y)
    USE GlobalDef
	IMPLICIT NONE
	REAL*8 T0,T1
    REAL*8 X(8),Y(8)  
    REAL*8 DELT,COST,SINT,COSD,SIND,COS2T,SIN2T,COS2D,SIN2D,COSP,SINP,COSC,SINC
    REAL*8 UR,UT,UP,UR1,UR2,UT1,UT2,UP1,UP2
    REAL*8 S1,S2,S3,S4,S5,S6

	Y(1)=X(5)
	Y(2)=X(6)
	Y(3)=X(7)
    Y(4)=X(8)
	DELT=X(2)-X(3)
	COST=DCOS(2D0*X(2))
	SINT=DSIN(2D0*X(2))
	COSD=DCOS(2D0*DELT)
	SIND=DSIN(2D0*DELT)
	COS2T=DCOS(4D0*X(2))
	SIN2T=DSIN(4D0*X(2))
	COS2D=DCOS(4D0*DELT)
	SIN2D=DSIN(4D0*DELT)
	COSP=DCOS(2D0*X(3))
	SINP=DSIN(2D0*X(3))
	COSC=DCOS(2D0*X(2)+2D0*DELT)
	SINC=DSIN(2D0*X(2)+2D0*DELT)

	S1=X(1)
	S2=S1*S1
	S3=S2*S1
	S4=S2*S2
	S5=S2*S3
	S6=S3*S3


	UR1=+1D0/S2 + 3D0/S4*(A1+A2*COST+A3*COSD)
	UR2=+1D0/S2 + 3D0/S4*(A1+A2*COST+A3*COSD) &
		+5D0/S6*(B1+B2*COST+B3*COS2T+B4*COSD+B5*COS2D+B6*COSP+B7*COSC)
	UT1=-MASS/S3*(-2D0*A2*SINT-2D0*A3*SIND)
	UT2=-MASS/S3*(-2D0*A2*SINT-2D0*A3*SIND) &
		-MASS/S5*(-2D0*B2*SINT-4D0*B3*SIN2T-2D0*B4*SIND-4D0*B5*SIN2D-4D0*B7*SINC)
	UP1=-MASS/S3*2D0*A3*SIND
	UP2=-MASS/S3*2D0*A3*SIND - MASS/S5*(2D0*B4*SIND+4D0*B5*SIN2D-2D0*B6*SINP+2D0*B7*SINC)

	UR=UR2
	UT=UT2
	UP=UP2


	Y(5)=+X(1)*(X(6)+X(8))**2-UR
	Y(6)=-2D0*X(5)*(X(6)+X(8))/X(1)-(1D0/IzA+1D0/MASS/S2)*UT-1D0/IzA*UP
	Y(7)=-1D0/IzA*UT-(1D0/IzA+1D0/IzB)*UP
	Y(8)=+1D0/IzA*(UT+UP)
      
	RETURN
    END
    
    SUBROUTINE YHC_PHI(t0,t1,X,Y)
    USE GlobalDef
    IMPLICIT NONE
	REAL*8 T0,T1
    REAL*8 X(2),Y(2)  
    REAL*8 FF
    REAL*8 S1,S2,S3,S4,S5

    CALL TWO_BODY(T1,FF)

	S1=(1-ECC**2)/(1d0+ECC*COS(FF))
	S2=S1*S1
	S3=S2*S1
	S4=S2*S2
	S5=S2*S3

	Y(1)=X(2)
	Y(2)=+2D0*MASS*A3/IzB*SIN(2D0*(FF-OmegaA_Con*T1-X(1)))/S3

    end
    
    SUBROUTINE two_body(t,f)
    USE GlobalDef
    IMPLICIT NONE
    REAL(8),INTENT(IN)::t
    REAL(8),INTENT(OUT)::f
    REAL(8)::m,ee,r
    REAL(8)::ff,fp,EPS

    EPS=1D0
    m=MOD(t,PI2)
    ee=m
    DO WHILE(EPS>1D-12)
	    ff=m-ee+ecc*SIN(ee)
	    fp=1D0-ecc*COS(ee)
	    EPS=ff/fp
	    ee=ee+EPS
    ENDDO

    r=1d0-ecc*cos(ee)

    f=ATAN2( SQRT(1D0-ecc**2)*SIN(ee)/r, (COS(ee)-ecc)/r )
    IF(f.LT.0D0) f=f+PI2


    END
    
    SUBROUTINE YHCM(T0,T1,X,Y)
    USE GlobalDef
	IMPLICIT NONE
	REAL*8 T0,T1
    REAL*8 X(72),Y(72)
    REAL*8 DELT,COST,SINT,COSD,SIND,COS2T,SIN2T,COS2D,SIN2D,COSP,SINP,COSC,SINC
    REAL*8 S1,S2,S3,S4,S5,S6,S7
    REAL*8 U1,U2,UR,UT,UP,URR,URT,URP,UTT,UTP,UPP
    REAL*8 UT1,UT2,UP1,UP2,UTT1,UTT2,UPP1,UPP2,UTP1,UTP2
    REAL*8 AA1,AA2,AA3,AA6,AA8,BB1,BB2,BB3,BB5,BB6,BB7,BB8,CC1,CC2,CC3&
        ,DD1,DD2,DD3
	Y(1)=X(5)
	Y(2)=X(6)
	Y(3)=X(7)
    Y(4)=X(8)
	DELT=X(2)-X(3)
	COST=DCOS(2D0*X(2))
	SINT=DSIN(2D0*X(2))
	COSD=DCOS(2D0*DELT)
	SIND=DSIN(2D0*DELT)
    COS2T=DCOS(4D0*X(2))
    SIN2T=DSIN(4D0*X(2))
    COS2D=DCOS(4D0*DELT)
    SIN2D=DSIN(4D0*DELT)
    COSP=DCOS(2D0*X(3))
    SINP=DSIN(2D0*X(3))
    COSC=DCOS(2D0*X(2)+2D0*DELT)
    SINC=DSIN(2D0*X(2)+2D0*DELT)
	S1=X(1)
	S2=S1*S1
	S3=S2*S1
	S4=S2*S2
	S5=S2*S3
    S6=S3*S3
    S7=S3*S4

    U1=A1+A2*COST+A3*COSD
    UT1=-2D0*A2*SINT-2D0*A3*SIND
    UP1=+2D0*A3*SIND
    UTT1=-4D0*A2*COST-4D0*A3*COSD
    UPP1=-4D0*A3*COSD
    UTP1=+4D0*A3*COSD


    UR=+MASS*(1D0/S2+3D0/S4*U1)
    UT=-MASS*(1D0/S3*UT1)
    UP=-MASS*(1D0/S3*UP1)

    URR=-MASS*(2D0/S3+12D0/S5*U1)
    UTT=-MASS*(1D0/S3*UTT1)
    UPP=-MASS*(1D0/S3*UPP1)
    URT=+MASS*(3D0/S4*UT1)
    URP=+MASS*(3D0/S4*UP1)
    UTP=-MASS*(1D0/S3*UTP1)


	Y(5)=+X(1)*(X(6)+X(8))**2-1D0/MASS*UR
	Y(6)=-2D0*X(5)*(X(6)+X(8))/X(1)-(1D0/IzA+1D0/MASS/S2)*UT-1D0/IzA*UP
	Y(7)=-1D0/IzA*UT-(1D0/IzA+1D0/IzB)*UP
	Y(8)=+1D0/IzA*(UT+UP)
      
    AA1=+(X(6)+X(8))**2-1D0/MASS*URR
    AA2=-1D0/MASS*URT
    AA3=-1D0/MASS*URP
    AA6=+2D0*S1*(X(6)+X(8))
    AA8=AA6
    BB1=+2D0*X(5)/S2*(X(6)+X(8))-(1D0/IzA+1D0/MASS/S2)*URT+2D0/MASS/S3*UT-1D0/IzA*URP
    BB2=-(1D0/IzA+1D0/MASS/S2)*UTT-1D0/IzA*UTP
    BB3=-(1D0/IzA+1D0/MASS/S2)*UTP-1D0/IzA*UPP
    BB5=-2D0/S1*(X(6)+X(8))
    BB6=-2D0*X(5)/S1
    BB8=BB6
    CC1=-1D0/IzA*URT-(1D0/IzA+1D0/IzB)*URP
    CC2=-1D0/IzA*UTT-(1D0/IzA+1D0/IzB)*UTP
    CC3=-1D0/IzA*UTP-(1D0/IzA+1D0/IzB)*UPP
    DD1=+1D0/IzA*(URT+URP)
    DD2=+1D0/IzA*(UTT+UTP)
    DD3=+1D0/IzA*(UTP+UPP)
           
    Y(9:40)=X(41:72)
    Y(41:48)=AA1*X(9:16)+AA2*X(17:24)+AA3*X(25:32)+AA6*X(49:56)&
        +AA8*X(65:72)
    Y(49:56)=BB1*X(9:16)+BB2*X(17:24)+BB3*X(25:32)+BB5*X(41:48)&
        +BB6*X(49:56)+BB8*X(65:72) 
    Y(57:64)=CC1*X(9:16)+CC2*X(17:24)+CC3*X(25:32)
    Y(65:72)=DD1*X(9:16)+DD2*X(17:24)+DD3*X(25:32)
      
	RETURN
    END
    
    SUBROUTINE YHCMB(T0,T1,X,Y)
    USE GlobalDef
	IMPLICIT NONE
	REAL*8 T0,T1
    REAL*8 X(72),Y(72)
    REAL*8 DELT,COST,SINT,COSD,SIND,COS2T,SIN2T,COS2D,SIN2D,COSP,SINP,COSC,SINC
    REAL*8 S1,S2,S3,S4,S5,S6,S7
    REAL*8 U1,U2,UR,UT,UP,URR,URT,URP,UTT,UTP,UPP
    REAL*8 UT1,UT2,UP1,UP2,UTT1,UTT2,UPP1,UPP2,UTP1,UTP2
    REAL*8 AA1,AA2,AA3,AA6,AA8,BB1,BB2,BB3,BB5,BB6,BB7,BB8,CC1,CC2,CC3&
        ,DD1,DD2,DD3
	Y(1)=X(5)
	Y(2)=X(6)
	Y(3)=X(7)
    Y(4)=X(8)
	DELT=X(2)-X(3)
	COST=DCOS(2D0*X(2))
	SINT=DSIN(2D0*X(2))
	COSD=DCOS(2D0*DELT)
	SIND=DSIN(2D0*DELT)
    COS2T=DCOS(4D0*X(2))
    SIN2T=DSIN(4D0*X(2))
    COS2D=DCOS(4D0*DELT)
    SIN2D=DSIN(4D0*DELT)
    COSP=DCOS(2D0*X(3))
    SINP=DSIN(2D0*X(3))
    COSC=DCOS(2D0*X(2)+2D0*DELT)
    SINC=DSIN(2D0*X(2)+2D0*DELT)
	S1=X(1)
	S2=S1*S1
	S3=S2*S1
	S4=S2*S2
	S5=S2*S3
    S6=S3*S3
    S7=S3*S4

    U1=A1+A2*COST+A3*COSD
    U2=B1+B2*COST+B3*COS2T+B4*COSD+B5*COS2D+B6*COSP+B7*COSC
    
    UT1=-2D0*A2*SINT-2D0*A3*SIND
    UT2=-2D0*B2*SINT-4D0*B3*SIN2T-2D0*B4*SIND-4D0*B5*SIN2D-4D0*B7*SINC
    UP1=+2D0*A3*SIND
    UP2=+2D0*B4*SIND+4D0*B5*SIN2D-2D0*B6*SINP+2D0*B7*SINC
    UTT1=-4D0*A2*COST-4D0*A3*COSD
    UTT2=-4D0*B2*COST-16D0*B3*COS2T-4D0*B4*COSD-16D0*B5*COS2D-16D0*B7*COSC
    UPP1=-4D0*A3*COSD
    UPP2=-4D0*B4*COSD-16D0*B5*COS2D-4D0*B6*COSP-4D0*B7*COSC
    UTP1=+4D0*A3*COSD
    UTP2=+4D0*B4*COSD+16D0*B5*COS2D+8D0*B7*COSC
    
    UR=+MASS*(1D0/S2+3D0/S4*U1+5D0/S6*U2)
    UT=-MASS*(1D0/S3*UT1+1D0/S5*UT2)
    UP=-MASS*(1D0/S3*UP1+1D0/S5*UP2)
    
    URR=-MASS*(2D0/S3+12D0/S5*U1+30D0/S7*U2)
    UTT=-MASS*(1D0/S3*UTT1+1D0/S5*UTT2)
    UPP=-MASS*(1D0/S3*UPP1+1D0/S5*UPP2)
    URT=+MASS*(3D0/S4*UT1+5D0/S6*UT2)
    URP=+MASS*(3D0/S4*UP1+5D0/S6*UP2)
    UTP=-MASS*(1D0/S3*UTP1+1D0/S5*UTP2)


	Y(5)=+X(1)*(X(6)+X(8))**2-1D0/MASS*UR
	Y(6)=-2D0*X(5)*(X(6)+X(8))/X(1)-(1D0/IzA+1D0/MASS/S2)*UT-1D0/IzA*UP
	Y(7)=-1D0/IzA*UT-(1D0/IzA+1D0/IzB)*UP
	Y(8)=+1D0/IzA*(UT+UP)
      
    AA1=+(X(6)+X(8))**2-1D0/MASS*URR
    AA2=-1D0/MASS*URT
    AA3=-1D0/MASS*URP
    AA6=+2D0*S1*(X(6)+X(8))
    AA8=AA6
    BB1=+2D0*X(5)/S2*(X(6)+X(8))-(1D0/IzA+1D0/MASS/S2)*URT+2D0/MASS/S3*UT-1D0/IzA*URP
    BB2=-(1D0/IzA+1D0/MASS/S2)*UTT-1D0/IzA*UTP
    BB3=-(1D0/IzA+1D0/MASS/S2)*UTP-1D0/IzA*UPP
    BB5=-2D0/S1*(X(6)+X(8))
    BB6=-2D0*X(5)/S1
    BB8=BB6
    CC1=-1D0/IzA*URT-(1D0/IzA+1D0/IzB)*URP
    CC2=-1D0/IzA*UTT-(1D0/IzA+1D0/IzB)*UTP
    CC3=-1D0/IzA*UTP-(1D0/IzA+1D0/IzB)*UPP
    DD1=+1D0/IzA*(URT+URP)
    DD2=+1D0/IzA*(UTT+UTP)
    DD3=+1D0/IzA*(UTP+UPP)
           
    Y(9:40)=X(41:72)
    Y(41:48)=AA1*X(9:16)+AA2*X(17:24)+AA3*X(25:32)+AA6*X(49:56)&
        +AA8*X(65:72)
    Y(49:56)=BB1*X(9:16)+BB2*X(17:24)+BB3*X(25:32)+BB5*X(41:48)&
        +BB6*X(49:56)+BB8*X(65:72) 
    Y(57:64)=CC1*X(9:16)+CC2*X(17:24)+CC3*X(25:32)
    Y(65:72)=DD1*X(9:16)+DD2*X(17:24)+DD3*X(25:32)
      
	RETURN
	END